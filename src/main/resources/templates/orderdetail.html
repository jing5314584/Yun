<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="keywords" content="花+,花加,flowerplus,鲜花,鲜花订阅">
<meta name="description"
	content="一周一花，用鲜花点亮生活,提供98元单品鲜花包月服务、168元混合鲜花包月服务和花艺周边配件、花艺课程服务。">
<meta name="format-detection" content="telephone=no">
<meta name="viewport"
	content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">

<title>订单详情</title>
<script>
	var _web_base = "https://t.flowerplus.cn/".replace(/^https?:/,
			window.location.protocol);
	//document.domain="flowerplus.cn";
</script>
<link rel="stylesheet"
	href="https://static2.flowerplus.cn/main_css.html?id=&_t=2018032903">
<script src="//res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script
	src="https://static2.flowerplus.cn/main_js.html?id=&_t=2018032903"></script>


<style>
.ships-item {
	position: relative;
	padding: 10px 2%;
}

.ships-item span.yyx {
	padding-top: 0;
	color: #ff9900;
	position: absolute;
	left: 50%;
	bottom: -5px;
	overflow: hidden;
	width: 100%;
	text-overflow: ellipsis;
	white-space: nowrap;
	transform: translate(-50%, 0);
	-webkit-transform: translate(-50%, 0);
}

.ships-item a.yx {
	padding-top: 0;
	display: block;
	width: 40px;
	padding: 0;
	border-radius: 3px;
	margin: 0 auto;
	line-height: 20px;
	color: #fff;
	background: #ff9900;
	height: auto;
	position: absolute;
	left: 50%;
	bottom: -5px;
	transform: translate(-50%, 0);
	-webkit-transform: translate(-50%, 0);
}

.ships-item span.transfer {
	border: 1px solid #b4b4b4;
	width: 40px;
	color: #b4b4b4;
	padding: 2px 0 !important;
	/* height:25px; */
	text-align: center;
	position: absolute;
	right: 3px;
	top: 6px;
	transform: rotate(-10deg);
	-webkit-transform: rotate(-10deg);
	/* z-index:3 */
}

.xq dl {
	padding: 15px 0;
}

.xq {
	position: relative;
}

.fy dl {
	padding: 6px 0;
}

.order-modify-bar a {
	background-image: none !important;
	font-size: 12px !important;
	margin: 8px 16px 8px 0;
	border-radius: 0;
	height: 32px;
	line-height: 32px;
	max-width: 88px;
	min-width: 86px;
	float: right;
	padding: 0;
}

.showMore {
	width: 88px;
	position: absolute;
	height: auto;
	bottom: 42px;
	z-index: 999;
	left: 8px;
	background: #999;
	border-radius: 4px;
}

.showMore::after {
	content: '';
	position: absolute;
	bottom: -8px;
	left: 38px;
	border-top: 8px #999 solid;
	border-right: 6px solid transparent;
	border-left: 6px transparent solid;
}

.showMore a {
	border: none;
	color: #fff;
	border-bottom: #666 solid 1px;
	margin: 0;
}

.showMore a:last-child {
	border: none;
}

.infoitem dd {
	text-align: right;
}

.infoitem dt {
	color: #666 !important;
}

.infoitem dd {
	color: #413f47;
}

.close_pay {
	width: 30%;
	padding: 6px 0;
	text-align: center;
	display: block;
	margin: 0 auto;
	border-radius: 3px;
	color: #000;
}

.xq dl:last-child {
	border-bottom-width: 0px !important;
}

.edit-order-out {
	padding: 15px 12px;
	border-bottom: 6px solid #e5e5e5;
}

.edit-order {
	display: flex;
	display: -webkit-flex;
	flex-direction: row-reverse;
	-webkit-flex-direction: row-reverse;
	padding-top: 15px;
}

.edit-order a {
	display: block;
	color: #333;
	padding: 6px 8px;
	border: 1px solid #898989;
	border-radius: 3px;
	margin-left: 15px;
}

.edit-order a:last-child {
	margin-left: 0;
}

.edit-order a.current {
	border: 1px solid #ff3366;
	color: #fff;
	background: #ff3366;
}

.edit-address {
	padding: 15px;
	border-bottom: 6px solid #e5e5e5;
	position: relative;
}

.edit-address a {
	border: 1px solid #ff3366;
	background: #fff;
	color: #ff3366;
	padding: 6px 10px;
	border-radius: 3px;
	position: absolute;
	right: 15px;
	top: 40%;
	transform: translate(0, -50%);
	-webkit-transform: translate(0, -50%);
}

.edit-addressl {
	padding-right: 20px;
}

.edit-addressl p {
	margin-bottom: 10px;
}

.fix-bar {
	position: fixed;
	bottom: 0;
	left: 0;
	border-top: 1px solid #e5e5e5;
	background: #fff;
	display: block;
}

@media screen and (min-width:960px) {
	.fix-bar {
		width: 640px !important;
		left: 50% !important;
		margin-left: -320px;
		background: #f9f9f9;
	}
	.ships-item span.transfer {
		right: 35px;
	}
}

#paymaxwxsubmit {
	display: block;
	margin: 20px 0;
	text-decoration: none;
	background: #00c739;
	color: #fff;
	font-size: 18px;
	padding: 10px;
	text-align: center;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	-webkit-transition: all .3s ease-out;
	transition: all .3s ease-out;
}

.ships-item a {
	line-height: 18px;
	position: relative;
	display: table;
	margin: 0 auto;
	font-size: 12px;
	width: 100%;
	height: 40px;
	border-radius: 2px;
}

.ships-item .flDate {
	display: table-cell;
	vertical-align: middle;
}

.ships-item .flDate p {
	margin: 0 5px;
	position: relative;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	max-width: 68px;
	margin: 0 auto;
}

.ships-item .flDate p:before {
	content: '';
	display: block;
	border-top: solid 1px #fff;
	transform: scale(1, 0.5);
	-webkit-transform: scale(1, 0.5);
	width: 28px;
	margin: 0 auto;
}
/********************************/
.showexpress_staff {
	display: block;
	padding-left: 15px;
	margin-bottom: 15px;

	/*color: #f73f65*/
}

.express_staff {
	width: 50%;
	/*border: 1px solid red;*/
	float: left;
	line-height: 1.8em;
}

.express_comment {
	width: 50%;
	/*border: 1px solid blue;*/
	float: left;
}

.express_comment a {
	float: left;
	margin-left: 20%;
}
/*sprite-z.png*/
.best_staff {
	width: 25px;
	height: 25px;
	display: block;
	position: relative;
}

.bad_staff {
	width: 25px;
	height: 25px;
	display: block;
	position: relative;
}
/*
no bad background-position:30% -40%;
*/
.img_source {
	background: url("/Static/img/kd/sprite_zan.png") no-repeat center;
	background-size: cover;
}

.img_low1 {
	background-position: 30% -40%;
}

.img_low2 {
	background-position: 100% -40%;
}

.img_good1 {
	background-position: 0% -40%;
}

.img_good2 {
	background-position: 70% -40%;
}

.renew {
	padding: 15px;
	display: -webkit-flex;
	display: flex;
	justify-content: space-between;
	-webkit-justify-content: space-between;
	align-items: center;
	-webkit-align-items: center;
}

input[type=checkbox].switch {
	-webkit-appearance: none;
	-moz-appearance: none;
	appearance: none;
	width: 40px;
	height: 24px;
	border: 1px solid #DFDFDF;
	border-radius: 20px;
	background-color: #fff;
	position: relative;
	transition: all .2s ease-out;
}

input[type=checkbox].switch:after {
	position: absolute;
	content: "";
	left: 1px;
	top: 50%;
	width: 22px;
	height: 22px;
	border-radius: 50%;
	background: #fff;
	transform: translate(0, -50%);
	transform: translate(0, -50%);
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
	-webkit-box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
}

input[type=checkbox].switch:checked {
	background: #ff6688;
}

input[type=checkbox].switch:checked:after {
	left: 17px;
	background: #fff;
}

.color_select {
	padding-left: 15px;
}

.color_select span {
	width: 72px;
	height: 32px;
	line-height: 32px;
	margin: 0 20px 16px 0;
	text-align: center;
	display: inline-block;
	background: #f5f5f5;
	color: #666;
	border-bottom: #ccc solid 2px;
}

.color_select span:nth-child(2) {
	border-bottom: #FFB3B9 solid 2px;
}

.color_select span:nth-child(3) {
	border-bottom: #D5E3C5 solid 2px;
}

.color_select span.current {
	background: #FF6672;
	color: #fff;
}

.pinfo-content {
	background: #fff;
}

.pinfo-content {
	position: relative;
	background: #FAFAFA;
	overflow: hidden;
	padding: 16px;
	margin-left: 0;
}

.pinfo-title {
	margin: 0 75px;
	white-space: nowrap;
	display: block;
	overflow: hidden;
	text-overflow: ellipsis;
}

.pinfo-sku1 {
	margin: 15px 75px 0 75px;
	color: #aaa;
	font-size: 12px;
}

.infoitem1 dd span.waitings_pay {
	background: #FF6672 url('/images/icons/Icon_pay.png') no-repeat center;
	background-size: 80% auto;
	-webkit-background-size: 80% auto;
}

.infoitem1 dd span {
	width: 40px;
	height: 40px;
	border-radius: 6px;
	display: inline-block;
	text-align: center;
	margin-right: 10px;
	vertical-align: middle;
}

.infoitem1 dd span.over {
	background: #FF6672
		url(/Static/gift_flower/images/all_img/Icon_over.png) no-repeat center;
	background-size: 80% auto;
	-webkit-background-size: 80% auto;
}

.infoitem1 dd span.song {
	background: #FF6672
		url(/Static/gift_flower/images/all_img/Icon_song.png) no-repeat center;
	background-size: 80% auto;
	-webkit-background-size: 80% auto;
}

.waitings_pay_price {
	color: #FF6672;
	float: right;
	text-align: right;
}

/***********************************/
/*忌讳的花*/
.fix_taboo .taboocon {
	padding: 15px;
	width: 100%;
	max-height: 50vh;
	overflow-y: auto;
	-webkit-overflow-scrolling: touch;
}

.laber_select {
	border: 1px solid #ff6672 !important;
	color: #fff;
	background: #FFADBF;
}

.middle_alert {
	position: fixed;
	top: 50%;
	left: 8%;
	right: 8%;
	overflow: auto;
	background-color: #fff;
	z-index: 2;
	opacity: 0;
	transform: translate(0, -50%) scale(0);
	-webkit-transform: translate(0, -50%) scale(0);
	border-radius: 3px;
	-webkit-transition: all 0.5s ease-in-out;
	transition: all 0.5s ease-in-out;
}

.trans_atrt {
	transform: translate(0, -50%) scale(1);
	-webkit-transform: translate(0, -50%) scale(1);
	opacity: 1;
}

.fix_taboo .taboocon,.fix_time .timecon {
	padding: 15px;
	width: 100%;
	max-height: 50vh;
	overflow-y: auto;
	-webkit-overflow-scrolling: touch;
}

.middle_alert button {
	width: 100%;
	height: 48px;
	text-align: center;
	color: #fff;
	background: #ff6672;
	border: 0;
}

.middle_alert span {
	display: inline-block;
	border: 1px solid #E5E5E5;
	border-radius: 2px;
	text-align: center;
	position: relative;
	padding: 3px 0;
	width: 30%;
	margin-bottom: 22px;
}

.fix_taboo .tabootip {
	font-size: 12px;
	color: #999;
	margin-top: 7px;
	margin-bottom: 5px;
}

.middle_alert span:nth-child(3n-1) {
	margin: 0 3%;
}

.mask {
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.7);
	position: fixed;
	left: 0;
	top: 0;
}

.infoitem1 dd span.waiting {
	background: #FF6672
		url(/Static/gift_flower/images/all_img/Icon_waitings.png) no-repeat
		center;
	background-size: 80% auto;
	-webkit-background-size: 80% auto;
}

.order-modify-bar {
	justify-content: space-between;
}

.moreBtn {
	float: left;
}

.delayAlert {
	min-width: 120px;
	height: 50px;
	background:
		url("https://oss.flowerplus.cn/oss_png/2018-04-19/15241229208713.png")
		no-repeat;
	background-size: 100%;
	position: absolute;
	padding: 8px;
	color: #ED952C;
	font-size: 10px;
	top: -57px;
	z-index: 1;
	left: 16px;
	border-radius: 2px 2px 2px 0;
}

.closeDelayAlert {
	width: 32px;
	height: 32px;
	position: absolute;
	right: -16px;
	top: -16px;
	background:
		url('https://oss.flowerplus.cn/oss_png/2018-04-19/15241228334649.png')
		no-repeat center center;
	background-size: 17px;
}

.ships-item:last-child .delayAlert {
	background:
		url("https://oss.flowerplus.cn/oss_png/2018-04-19/15241272434861.png")
		no-repeat;
	background-size: 100%;
	right: 16px;
	left: inherit;
}

.ships-item:first-child .delayAlert {
	background:
		url("https://oss.flowerplus.cn/oss_png/2018-04-19/15241229208713.png")
		no-repeat;
	background-size: 100%;
	right: inherit;
	left: 16px;
}

.ships {
	overflow: inherit;
	min-height: 95px;
}

.ships::after {
	content: "\0020";
	display: block;
	height: 0;
	clear: both;
}

.flower_pay div #bocom_pay_submit {
	padding: 15px 0;
	text-align: center;
	display: block;
	width: 100%;
	background: #1f72ce;
	color: #fff;
}
</style>


</head>
<body>
	<div class="page">

		<div class="order-out" style="position:relative;">
			<div class="padding_15 borderBottom"
				style="border-top:0 none;overflow:hidden">
				<dl class="infoitem1">
					<dt style="float:left"></dt>
					<dd>
						<span class="waitings_pay"></span> <strong>交易取消</strong>
					</dd>
				</dl>

			</div>
			<!--  -->
			<!-- 时间地址修改部分-->
			<!--  -->
			<div class="edit-address borderTop">
				<strong style="float:  left;">收货信息</strong>
				<!-- <div id="phone" style="margin-left: 80px;display:none;"></div> -->
				<div id="address" class="edit-addressl" style="margin-left: 80px;">
					<!-- <p>景朋飞  15316028637</p>
                <p>上海上海市宝山区远洋香奈50单元</p> -->
				</div>
				<!--  -->
			</div>
			<!-- 时间地址修改部分 -->
			<!-- 订单的详细信息 -->
			<div>
				<p style="padding:15px;" class="borderBottom">
					<strong>商品信息</strong>
				</p>
				<!-- 图片文字信息 -->
				<div class="pinfo-wrap">
					<div class="pinfo-content"></div>

					<!-- 礼物订单入口查看详情不能看价格显示 -->

				</div>
				<!-- 图片文字信息 -->
				<div style="padding:0 15px;border-bottom:6px solid #e5e5e5;"
					class="xq">
					<!-- -----------     -->
					<!--         <dl class="infoitem borderTop"><dt>配送方式:</dt><dd>快递配送 -->
					<!--  -->
					<!-- </dd></dl> -->

					<!--区分代收点和提货地点-->
					<!--             <dl class="infoitem"><dt>收货人/手机:</dt><dd>景朋飞 / 15316028637</dd></dl>
            <dl class="infoitem"><dt>收货地址:</dt><dd>上海 上海市 宝山区 远洋香奈50单元 -->
					<!--  -->
					<!-- </dd></dl> -->

					<!--  -->
					<!-- ------------- -->
					<dl class="infoitem" style="border:none;">
						<dt>订单号:</dt>
						<dd id="orderid"></dd>
					</dl>
					<dl class="infoitem" style="border:none;">
						<dt>下单时间:</dt>
						<dd id="createtime"></dd>
					</dl>
					<dl class="infoitem">
						<dt>付款方式:</dt>
						<dd>
							<span>微信支付</span>
						</dd>
					</dl>

				</div>
			</div>

			<!-- 从礼物订单入口跳转过来的的不能修改色系 -->
			<!--              -->

			<!--      -->
			<!-- 订单的详细信息 -->
			<!-- 从礼物订单入口跳转过来的的if判断开始 -->
			<!--自动续约-->
			<!--自动续约-->

			<!-- 费用信息    -->

			<p class="borderTop">
			<div style="width:30%;float:left;padding:15px" class="up_money">
				<strong>应付</strong>
			</div>
			<div
				style="width:70%;text-align:right;float:left;padding:15px;color:#ff5d7c"
				class="up_money" id="yingfue">￥24.90</div>
			<div style="clear:both"></div>
			</p>
			<div class="padding_15 fy up_money"
				style="margin-bottom: 48px;border-bottom: 6px solid #e5e5e5;">
				<dl class="infoitem">
					<dt>商品总额:</dt>
					<dd>
						<span id="zonge">￥24.90</span>
					</dd>
				</dl>
				<dl class="infoitem">
					<dt>运费:</dt>
					<dd>
						<span>￥0.00</span>
					</dd>
				</dl>
				<dl class="infoitem">
					<dt>付款金额:</dt>
					<dd>
						<span class="confirm-price" id="fukuane">￥24.90</span>
					</dd>
				</dl>
			</div>
			<!-- 费用信息    -->


			<!-- <div class="weiquan_wrap">

    </div> -->
			<!-- 按钮 -->

			<div class="order-modify-bar fix-bar">
				<a href="javascript:;" class="wait_pay"
					style="border-color:#ff5d7c;color:#ff5d7c">去支付</a> <a
					class="order-cancel" href="javascript:;"> <span
					id="cancelorder">取消订单</span>
				</a>
			</div>

			<div class="order-modify-bar">
				<!-- 
                <div class="moreBtn">更多</div>
        <div class="showMore" style="display: none;">
                                    <a href="javascript:void(0)" out_name="WX" id="serviceItem" class="current">申请售后</a>
                        <a class="order-hide" id="hideorder" href="javascript:;">删除订单</a>
        </div> -->


				<!--                                                   -->
				<!--         <a class="order-hide" id="hideorder" href="javascript:;">隐藏订单</a>
         -->
				<!--  -->
				<!--          -->
				<!-- 按钮 -->
				<!--  -->
				<!--                      <a class="xuding" data-product-id="50081" href="/buy/oncebuy?id=NDO83MBa50081&oid=13692586" style="border-color:#ff5d7c;color:#ff5d7c;background:none">一键续订</a>
             -->
			</div>
			<!-- 按钮 -->
			<!-- 从礼物订单入口跳转过来的的if判断结束 -->
			<script type="text/javascript" src="/js/util.js"></script>
			<script type="text/javascript" src="/js/layer.js"></script>
			<script type="text/javascript">
				if ($(".order-modify-bar").hasClass('fix-bar')) {
					$(".order-out").css('paddingBottom', '70px');
				}
				var prepay_id;
				var paySign;
				var appId;
				var timeStamp;
				var nonceStr;
				var packageStr;
				var signType;
				var orderid = GetQueryString("id");
				$
						.ajax({
							url : "getorderdetail",
							type : "POST",
							data : {
								"orderid" : orderid
							},
							async : false,
							success : function(data) {
								FP.loading().hide();
								console.log("GetProducts", data.data);
								var order = data.data;
								//$("#phone").text(order.mobile);
								$("#address").append(
										"<p>" + order.consignee + "  "
												+ order.mobile + "</p><p>"
												+ order.province + order.city
												+ order.district
												+ order.address + "</p>");
								$(".pinfo-content")
										.html(
												"<div class=\"pinfo-image\"><img with=\"64px\" height=\"64px\" src=\""+order.goodsImg+"\"></div>"
														+ "<div class=\"pinfo-title\">"
														+ order.goodsName
														+ "</div>"
														+ "<div class=\"pinfo-sku1\">"
														+ order.goodsBrief
														+ "<br>"
														+ "</div><div class=\"pinfo-price\">x1</div>")
								$("#orderid").html("WX" + order.id);
								var time = formatDate(order.createTime);
								//alert(time);
								$("#createtime").html(
										formatDate(order.createTime));
								$("#yingfue").html("￥" + order.price / 100);
								$("#zonge").html("￥" + order.price / 100);
								$("#fukuane").html("￥" + order.price / 100);
							}
						});
				$(".wait_pay").click(function(event) {

					$.ajax({
						url : "WxPayNew",
						type : "POST",
						data : {
							"orderId" : orderid
						},
						async : false,
						success : function(data) {
							var t = JSON.parse(data);
							console.log("WxPay", data);

							appId = t.appId;
							paySign = t.paySign;
							timeStamp = t.timeStamp;
							nonceStr = t.nonceStr;
							packageStr = t.package;
							signType = t.signType;
							console.log("appId", t.appId);
							console.log("paySign", t.paySign);
							console.log("timeStamp", t.timeStamp);
							console.log("nonceStr", t.nonceStr);
							console.log("package", t.package);
							console.log("signType", t.signType);
							callpay();

						}
					});

				});
				function onBridgeReady() {
					alert("appId:" + appId + ",paySign:" + paySign
							+ ",timeStamp:" + timeStamp + ",nonceStr:"
							+ nonceStr + ",packageStr:" + packageStr
							+ ",signType");
					WeixinJSBridge
							.invoke(
									'getBrandWCPayRequest',
									{
										"appId" : appId, //公众号名称，由商户传入
										"paySign" : paySign, //微信签名
										"timeStamp" : timeStamp, //时间戳，自1970年以来的秒数
										"nonceStr" : nonceStr, //随机串
										"package" : packageStr, //预支付交易会话标识
										"signType" : signType
									//微信签名方式
									},
									function(res) {
										if (res.err_msg == "get_brand_wcpay_request:ok") {
											//window.location.replace("index.html");
											//询问框
											layer.open({
												content : '确认要删除吗？',
												btn : [ '确定' ],
												yes : function(index) {
													layer.close(index);
													window.location.reload();
												}
											});

										} else if (res.err_msg == "get_brand_wcpay_request:cancel") {
											alert('支付取消');
										} else if (res.err_msg == "get_brand_wcpay_request:fail") {
											alert('支付失败');
										} //使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
									});
				}
				function callpay() {
					if (typeof WeixinJSBridge == "undefined") {
						if (document.addEventListener) {
							document.addEventListener('WeixinJSBridgeReady',
									onBridgeReady, false);
						} else if (document.attachEvent) {
							document.attachEvent('WeixinJSBridgeReady',
									onBridgeReady);
							document.attachEvent('onWeixinJSBridgeReady',
									onBridgeReady);
						}
					} else {
						onBridgeReady();
					}
				}
				/*  function onBridgeReady() {
					//alert('开始支付');
					alert("appId:"+appId+",paySign:"+paySign+",timeStamp:"+timeStamp+",nonceStr:"+nonceStr+",packageStr:"+packageStr+",signType");
					WeixinJSBridge
							.invoke(
									'getBrandWCPayRequest',
									{
										"appId" : appId, //公众号名称，由商户传入
										"paySign" : paySign, //微信签名
										"timeStamp" : timeStamp, //时间戳，自1970年以来的秒数
										"nonceStr" : nonceStr, //随机串
										"package" : packageStr, //预支付交易会话标识
										"signType" : signType
									//微信签名方式
									},
									function(res) {
										if (res.err_msg == "get_brand_wcpay_request:ok") {
											//window.location.replace("index.html");
											alert('支付成功');
										} else if (res.err_msg == "get_brand_wcpay_request:cancel") {
											alert('支付取消');
										} else if (res.err_msg == "get_brand_wcpay_request:fail") {
											alert('支付失败');
										} //使用以上方式判断前端返回,微信团队郑重提示：res.err_msg将在用户支付成功后返回    ok，但并不保证它绝对可靠。
									});
				} */
				/* function onBridgeReady(){
				    WeixinJSBridge.invoke(
				        'getBrandWCPayRequest',
				        eval("("+jsApiParameters+")"),
				        function(res){
				            jsApiParameters="";
				            if(res.err_msg == "get_brand_wcpay_request:ok" ) {
				                var whenpayok=function(){
				                    if(activity_group == 1){
				                        if(productid > 50000){
				                            window.location.href="/activity_group/detail_new?oid="+group_oid;
				                        }else{
				                            window.location.href="/activity_group/detail?oid="+group_oid;
				                        }
				                    }else{
				                        window.location.replace('/my/');
				                    }
				                    isruning=false;
				                    $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
				                };
				                isruning=true;
				                $("#paymaxwxsubmit").html("正在确认支付结果，请稍候！").addClass("buttondisabled");
				            }else{
				                isruning=false;
				                $("#paymaxwxsubmit").html("微信支付").removeClass("buttondisabled");
				            }
				        }
				    )
				} */
				function formatDate(time) {
					var date = new Date(time);

					var year = date.getFullYear(), month = date.getMonth() + 1, //月份是从0开始的
					day = date.getDate(), hour = date.getHours(), min = date
							.getMinutes(), sec = date.getSeconds();
					var preArr = Array.apply(null, Array(10)).map(
							function(elem, index) {
								return '0' + index;
							});////开个长度为10的数组 格式为 00 01 02 03

					var newTime = year + '-' + (preArr[month] || month) + '-'
							+ (preArr[day] || day) + ' '
							+ (preArr[hour] || hour) + ':'
							+ (preArr[min] || min) + ':' + (preArr[sec] || sec);

					return newTime;
				}
			</script>

			<!-- 按钮 -->
			<!--<div class="refund_ok">
        <img src="//static2.flowerplus.cn/Static/img/iconfont-success.png" width="64" />
        <p style="color:#000;padding:15px 0;line-height:2em"><strong>订单已取消</strong><p style="color:#999">如已付款，款项会在1~5个工作日内退回到付款账户</p></p>
        <p style="padding:15px 0"><a href="javascript:window.location.replace('/my/');" >我的所有订单</a></p>
    </div>-->

			<div class="right-dialog" id="shipWrap">
				<h2>
					发货详情<a class="right-dialog-close" href="javascript:;"></a>
				</h2>
				<div class="right-dialog-content" style="padding:20px 0"
					id="shipDetail"></div>
			</div>

			<div class="right-dialog" id="modifyAddressWrap">
				<h2>
					第0次起（0）<a class="right-dialog-close" href="javascript:;"></a>
				</h2>
				<div class="right-dialog-content" id="modifyAddress">
					<!-- <dl class="times-tips"><dt>第0次起（0）</dt><dd>请注意上方的日期</dd></dl> -->
					<dl class="deliver-item">
						<dt>收货人</dt>
						<dd>
							<input type="text" id="receiver_name" placeholder="姓名">
						</dd>
					</dl>
					<dl class="deliver-item">
						<dt>手机</dt>
						<dd>
							<input type="tel" id="receiver_mobile" placeholder="收货人手机">
						</dd>
					</dl>
					<dl class="deliver-item">
						<dt>所在地区</dt>
						<dd class="address_area">
							<select class="form-control" id="receiver_state"
								name="receiver_state"><option>选择省份</option></select> <select
								class="form-control" id="receiver_city" name="receiver_city"><option>选择城市</option></select>
							<select class="form-control" id="receiver_district"
								name="receiver_district"><option>选择区县</option></select>
						</dd>
						<dd style="color:#999;font-size:12px;padding-top:10px">注意：只能选择"上海"内的区域</dd>
					</dl>
					<dl class="deliver-item">
						<dt>详细地址</dt>
						<dd>
							<input type="text" id="receiver_address" placeholder="街道门牌信息">
						</dd>
					</dl>
					<div class="deliver-save-wrap">
						<button class="deliver-save" id="confirmaddress">保存</button>
					</div>
					<dl class="address_log">
						<dt>历史地址</dt>
					</dl>
				</div>
			</div>

			<div class="right-dialog" id="modifyDeliveryDateWrap">
				<h2>
					第0次起（0）<a class="right-dialog-close" href="javascript:;"></a>
				</h2>
				<div class="right-dialog-content" style="padding:20px 0"
					id="modifyAddress">
					<!-- <dl class="times-tips"><dt>第0次起（0）</dt><dd>请注意上方的日期，每次操作顺延一周，可多次操作</dd></dl> -->
					<div style="padding:20px 15px;text-align:center">
						<button class="deliver-save" id="confirmshunyan">点击确认顺延一周</button>
					</div>
					<p style="text-align: center;">提示：如果需要顺延两周或更多，可重复操作。</p>
				</div>
			</div>
		</div>

		<div
			style="width:100%;height:100%;position:fixed;left:0;top:0;background:rgba(0,0,0,0.75);z-index:3;display:none"
			class="grayout"></div>
		<!-- 弹窗的事件 -->
		<div
			style="padding:10px 20px 20px 20px;position:fixed;background:#fff;width:90%;left:5%;bottom:50px;z-index:3;display:none"
			class="flower_pay">

			<span class="close_pay">取消</span>
		</div>
		<div class="mask" style="display: none"></div>
		<!-- 忌讳的花弹窗 -->
		<div class="fix_taboo middle_alert">
			<div class="taboocon">

				<!-- <span class="select">康乃馨</span> -->
				<ul class="tabootip"
					style="list-style-type: disc;margin-left: 16px;">
					<li>为尽可能使您收到不同品种的花，最多可选三项</li>
					<li>孕妇不宜的花包括百合、郁金香等浓香品种</li>
					<li>忌讳的花仅适用于简花</li>

				</ul>
			</div>
			<button class="sure jihui_sure">确定</button>
		</div>


		<script type="text/javascript"
			src="https://static2.flowerplus.cn/js/address.b.js?_t=55"></script>
		<script>
			$.address_b.list[0] = {
				n : '选择省份',
				c : [ {
					n : '选择城市',
					a : [ '选择区县' ]
				} ]
			};
			$.address_b("receiver_state", "receiver_city", "receiver_district",
					"上海", "上海市", "宝山区");
			var last_times = "0";
			var last_date = "0";
			var id = 13692586, isruning = false, jsApiParameters = "", payment = "24.90", status = "TRADE_CLOSED_BY_USER", productid = "50081", order_type = "1143";
			var activity_group = '0';
			var group_oid = '';
			var product_name = '【新客专享3人团】太阳花闪购';
			$(".payandsubmit").bind("click", function() {
				var payway = $(this).attr('payway');
				request(payway);
			});

			function request(payway) {
				if (parseFloat(payment) <= 0) {
					return;
				}
				if (isruning) {
					return;
				}
				if (payway == 1) {
					if (jsApiParameters != "") {
						return;
					}
					$("#payandsubmit").html("微信支付启动中...").addClass(
							"buttondisabled");
					isruning = true;
					/*  $.post('/my/wxpay',{id:id},function(v){
					        if(v.f){
					            jsApiParameters=v.data;
					            //alert(jsApiParameters);
					            isruning=false;
					            wxpay();

					        }else{
					            FP.showError(v.data);
					            isruning=false;
					            $("#payandsubmit").html("微信支付").removeClass("buttondisabled");
					        }
					    },"json");*/
					FP.ajaxPost("/my/wxpay", {
						id : id,
						group_oid : group_oid
					}, function(v) {
						isruning = false;
						if (v.f) {
							jsApiParameters = v.data;
							wxpay();
						} else {
							FP.showError(v.data);
							$("#payandsubmit").html("微信支付").removeClass(
									"buttondisabled");
						}
					}, function() {
						isruning = false;
						FP.showError('请求失败,请重试');
						$("#payandsubmit").html("微信支付").removeClass(
								"buttondisabled");
					}

					);
				} else if (payway == 11) {
					if (jsApiParameters != "") {
						return;
					}
					$("#paymaxwxsubmit").html("微信支付启动中...").addClass(
							"buttondisabled");
					isruning = true;

					FP.ajaxPost("/my/paymaxwx", {
						id : id,
						group_oid : group_oid
					}, function(v) {
						isruning = false;
						if (v.f) {
							jsApiParameters = v.data;
							paymaxwx();
						} else {
							FP.showError(v.data);
							$("#paymaxwxsubmit").html("微信支付").removeClass(
									"buttondisabled");
						}
					}, function() {
						isruning = false;
						FP.showError('请求失败,请重试');
						$("#paymaxwxsubmit").html("微信支付").removeClass(
								"buttondisabled");
					}

					);
				} else if (payway == 15) {
					$('#payandsubmit').html("支付启动中").addClass("buttondisabled");
					isruning = true;

					FP.ajaxPost("/wj/get_pay_url", {
						id : id,
						group_oid : group_oid
					}, function(v) {
						isruning = false;
						if (v.f) {
							window.location.href = v.data;
						} else {
							FP.showError(v.data);
							$('#payandsubmit').html("微匠支付").removeClass(
									"buttondisabled");
						}
					}, function() {
						isruning = false;
						FP.showError('请求失败,请重试');
						$('#payandsubmit').html("微匠支付").removeClass(
								"buttondisabled");
					}

					);
				} else if (payway == 19) {
					$('#payandsubmit').html("支付启动中").addClass("buttondisabled");

					isruning = true;

					FP.ajaxPost("/unionpay/get_pay_url", {
						id : id,
						group_oid : group_oid
					}, function(v) {
						pay_isruning = false;
						if (v.f) {
							$(document.body).append(v.data);
						} else {
							FP.showError(v.data);
							$('#payandsubmit').html("在线支付").removeClass(
									"buttondisabled");
						}
					}, function() {
						isruning = false;
						FP.showError('请求失败,请重试');
						$('#payandsubmit').html("在线支付").removeClass(
								"buttondisabled");
					}

					);
				} else if (payway == 20) {
					//此时应该生成支付流水
					$('#payandsubmit').html("买单吧支付启动中").addClass(
							"buttondisabled");
					var bocompayPostData = {
						id : id,
						group_oid : group_oid
					};
					if ($('.renew').find('input[name=renew]').is(':checked')) {
						bocompayPostData.renew = 1;
					} else {
						bocompayPostData.renew = 0;
					}
					pay_isruning = true;
					FP.ajaxPost('/bocom/pre_pay', bocompayPostData,
							function(v) {
								if (v.f) {
									//window.location.href=v.data;//跳转至支付链接
									bocompay(v.data, {
										id : id
									});
								} else {
									if (v.data.indexOf('login') != -1) {
										var url = window.location.href;
										window.location.href = _web_base
												+ '/bocom/outh?callback_url='
												+ escape(url);
									} else {
										FP.showError(v.data);
										$(".pay_right a").html("买单吧支付")
												.removeClass("buttondisabled");
										$('#payandsubmit').html("买单吧支付启动中")
												.removeClass("buttondisabled");
									}
								}
							}, function() {
								pay_isruning = false;
								FP.showError('请求失败,请重试');
								$('#payandsubmit').html("买单吧支付").removeClass(
										"buttondisabled");
							}

					)
					//FP.showError('交行信用卡支付');return false;

				} else if (payway == 3) {
					$('#gocmbpay').submit();
				} else {
					$('#goalipay').submit();
				}
			}
			function paymaxwx() {
				if (typeof WeixinJSBridge == "undefined") {
					if (document.addEventListener) {
						document.addEventListener('WeixinJSBridgeReady',
								onBridgeReady, false);
					} else if (document.attachEvent) {
						document.attachEvent('WeixinJSBridgeReady',
								onBridgeReady);
						document.attachEvent('onWeixinJSBridgeReady',
								onBridgeReady);
					}
				} else {
					onBridgeReady();
				}
			}

			//$(function(){wxpayConditionComplete()});
			window.onload = function() {
				wxpayConditionComplete();
			}

			function wxpay() {
				if (typeof WeixinJSBridge != "undefined") {
					wxpayConditionComplete();
				} else {
					if (document.addEventListener) {
						document.addEventListener('WeixinJSBridgeReady',
								wxpayConditionComplete, false);
					} else if (document.attachEvent) {
						document.attachEvent('WeixinJSBridgeReady',
								wxpayConditionComplete);
						document.attachEvent('onWeixinJSBridgeReady',
								wxpayConditionComplete);
					}
				}
			}
			//防止页面没有加载完成启动微信支付
			function wxpayConditionComplete() {
				if (typeof window._WXPAY_COUNTER == 'undefined') {
					window._WXPAY_COUNTER = 2;
				}
				window._WXPAY_COUNTER = window._WXPAY_COUNTER - 1;
				if (window._WXPAY_COUNTER <= 0 && jsApiParameters != '') {
					window.setTimeout(jsApiCall, 0);
				}
			}

			//调用微信JS api 支付
			function jsApiCall() {
				$("#payandsubmit").html("微信支付已启动,请完成支付");
				WeixinJSBridge
						.invoke(
								'getBrandWCPayRequest',
								eval("(" + jsApiParameters + ")"),
								function(res) {
									jsApiParameters = "";

									if (res.err_msg == "get_brand_wcpay_request:ok") {
										var whenpayok = function() {
											if (activity_group == 1) {
												if (productid > 50000) {
													window.location.href = "/activity_group/detail_new?oid="
															+ group_oid;
												} else {
													window.location.href = "/activity_group/detail?oid="
															+ group_oid;
												}
											} else {
												window.location
														.replace('/my/order_success?oid='
																+ id);
											}
											// window.location.replace('/my/order_success?oid='+id+'&order_type='+order_type+'&productid='+productid+'&activity_group='+activity_group+'&group_oid='+group_oid);
											isruning = false;
											$("#payandsubmit").html("微信支付")
													.removeClass(
															"buttondisabled");
										};
										isruning = true;
										$("#payandsubmit")
												.html("正在确认支付结果，请稍候！")
												.addClass("buttondisabled");
										FP.ajaxPost('/my/wxpaycheck/', {
											id : id
										}, function(v) {
											whenpayok();
										}, function(v) {
											whenpayok();
										}

										);

										//window.location.reload();

									} else {
										isruning = false;
										$("#payandsubmit").html("微信支付")
												.removeClass("buttondisabled");
									}
								});
			}

			$("#cancelorder").bind("click", function() {
				if (isruning) {
					return;
				}
				if (jsApiParameters != "") {
					return;
				}
				if (!window.confirm('确认要取消此订单？')) {
					return;
				}
				var btn = $(this).html("处理中...");
				isruning = true;
				$.post('/my/cancelorder', {
					id : id
				}, function(v) {
					if (v.f) {
						if ('' == '1') {
							window.location.reload();
							return false;
						} else {
							window.location.href = '/my/order_cancel';
						}
					} else {
						alert(v.data);
					}
					btn.html("取消订单");
					isruning = false;

				}, "json");

				ga_cancel();
			});

			function weiquan() {
				//if(status!="")
				$.get("/my/weiquan", {
					id : id
				}, function() {

				});
			}

			// if(window.location.hash=="#pay"){
			//  window.location.hash="";
			//  request(1);
			// }

			$(".ships_info").delegate("a", "click", function(e) {
				e.stopPropagation();/*$("#shipWrap").addClass("right-dialog-show");*/
				loadShip($(this).attr("data-id"));
				return false;
			});
			$("#modifyAddress").bind("click", function(e) {
				e.stopPropagation();
				$("#modifyAddressWrap").addClass("right-dialog-show");
				getAddress();
				return false;
			});
			$("#modifyDeliveryDate").bind("click", function(e) {
				e.stopPropagation();
				$("#modifyDeliveryDateWrap").addClass("right-dialog-show");
				return false;
			});
			$(".right-dialog-close").bind(FP.EVENT_CLICK, function(e) {
				e.stopPropagation();
				$(".right-dialog").removeClass("right-dialog-show");
				history.go(0);
				return false;
			});
			$("#changeToDaishou").bind('click', function(e) {
				e.stopPropagation();
				$(".order-out").hide();

				//隐藏底部菜单
				$(".order-modify-bar").hide();

				ds_show_daishou_picker_with_oid(id);
			});
			$("#changeDaishou").bind('click', function(e) {
				e.stopPropagation();
				$(".order-out").hide();
				//隐藏底部菜单
				$(".order-modify-bar").hide();

				ds_show_daishou_picker_with_oid(id);
			});
			$("#cancelDaishou").bind('click', function(e) {
				var confirm = window.confirm("确定取消使用代收服务吗?");
				if (confirm) {
					e.stopPropagation();
					getAddress();
					$("#modifyAddressWrap").addClass("right-dialog-show");
					FP.showError('需要您选择新的收货地址');
					return false;
				}
				;
			});

			//倒计时
			var time = "2018/05/23 17:18:41";
			var endtime = new Date(time).getTime();
			console.log(endtime);
			function checktime(i) {
				if (i < 10) {
					i = "0" + i;
				} else {
					i = i;
				}
				return i;
			}

			var status = "TRADE_CLOSED_BY_USER";
			if (status == 'WAIT_PAY') {
				function freshTime() {
					var nowtime = new Date();

					var lefttime = parseInt(endtime - nowtime.getTime());
					console.log(lefttime);

					// var dm=24*60*60*1000;
					// var d=parseInt(lefttime/dm);  
					var hm = 60 * 60 * 1000;
					var h = parseInt((lefttime / hm));
					var mm = 60 * 1000;
					var m = parseInt((lefttime / mm) % 60);
					var s = parseInt((lefttime / 1000) % 60);
					m = checktime(m);
					s = checktime(s);
					h = checktime(h);
					// d=checktime(d);
					// $(".day").html(d);
					if (h > 0) {
						$(".hour").html(h + 'h:');
					}
					$(".minuse").html(m + 'm:');
					$(".second").html(s);
					if (lefttime < 0) {
						$('.show_time').hide();
						// $(".hour").html("00");
						// $(".minuse").html("00");
						// $(".second").html("00");
						$('.time_out').css('opacity', '0');
						// $('.wait_pay').hide();  
					} else {
						sh = setTimeout(function() {
							freshTime();
						}, 1000)
						$('.time_out').css('opacity', '1');
					}
				}
				freshTime();
			}
			function ds_when_selected_daishou(daishou_data) {
				saveAddressForDaishou(daishou_data);
			};

			function ds_hide_daishou_picker() {
				$(".ds_wpage").hide().siblings('.order-out').show();

				//隐藏底部菜单
				$(".order-modify-bar").show();
			};

			function loadShip(id) {
				/*var wrap=$("#shipDetail").html("<div style='color:#777;text-align:center;padding:30px 0'> 加载中...</div>");
				wrap.load("/my/shipitem/?id="+id+'&gift_status='+'0');*/
				window.location = "/my/shipitem/?id=" + id + '&gift_status='
						+ '0'
			}
			function getroute() {//alert(32);
				//console.log($(this));
				var id = $(this).attr("data-id");
				var express_com = $(this).attr("data-express-com");
				var express_id = $(this).attr("data-express-id");
				var p = $(".routes[data-id='" + id + "']").show();
				var btn = $(this).html("刷新").prop("disabled", true);
				p
						.html('<p style="color:#999;text-align:center;padding:10px 0">正在查询...</p>');
				$.get('/kd/getroute', {
					express_com : express_com,
					express_id : express_id,
					ships_id : id
				}, function(v) {
					p.html(v);
					btn.prop("disabled", false);
				})
			}
			$("body").delegate(".showroute", "click", getroute);
			$("#confirmaddress").bind("click", function() {
				saveAddressForExpress();
			});

			function saveAddressForExpress() {
				var address = {
					receiver_name : $("#receiver_name").val().replace(
							'/^\s|\s$/g', ''),
					receiver_mobile : $("#receiver_mobile").val().replace(
							'/^\s|\s$/g', ''),
					receiver_state : $("#receiver_state").val(),
					receiver_city : $("#receiver_city").val(),
					receiver_district : $("#receiver_district").val(),
					receiver_address : $("#receiver_address").val().replace(
							'/^\s|\s$/g', ''),
				};
				if (address.receiver_name == "") {
					FP.showError("请填写收货人姓名！");
					return;
				}
				if (address.receiver_mobile == "") {
					FP.showError("请填写收货人手机！");
					return;
				}
				if (address.receiver_state == ""
						|| address.receiver_state == "选择省份") {
					FP.showError("选择省份");
					return;
				}
				if (address.receiver_city == ""
						|| address.receiver_city == "选择城市") {
					FP.showError("选择城市");
					return;
				}
				if (address.receiver_district == ""
						|| address.receiver_district == "选择区县") {
					FP.showError("选择区县");
					return;
				}
				if (!/^1\d{10}$/.test(address.receiver_mobile)) {
					FP.showError("收货人手机号码格式错误！");
					return;
				}
				if (address.receiver_address == "") {
					FP.showError("详细地址！");
					return;
				}

				var btn = $(this).prop("disabled", true);
				$.post('/buy/addaddress', address, function(v) {
					if (v.f) {
						//getAddress();
						$("#receiver_name").val("");
						$("#receiver_mobile").val("");
						$("#receiver_address").val("");
						$.address_b("receiver_state", "receiver_city",
								"receiver_district");
						adds = v.list;
						updateAddressList();
						selectAddress(v.id);
					} else {
						FP.showError(v.data);
					}
					btn.prop("disabled", false);
				}, "json");
			}

			function saveAddressForDaishou(daishou_data) {
				var address = {
					receiver_name : daishou_data.receiver_name,
					receiver_mobile : daishou_data.receiver_mobile,
					receiver_state : daishou_data.receiver_state,
					daishou_stations : daishou_data.daishou_shop_id,
					express_type : "fetch"
				};

				if (address.receiver_name == "") {
					FP.showError("请填写提货人姓名！");
					return;
				}
				if (address.receiver_mobile == "") {
					FP.showError("请填写提货人手机！");
					return;
				}

				var btn = $(this).prop("disabled", true);
				$.post("/my/updateaddress/?id=" + id, address, function(v) {
					if (v.f) {
						alert('修改成功！');
						window.location.reload();
					} else {
						FP.showError(v.data);
						btn.prop("disabled", false);
					}
				}, "json");
			}

			var gotAddress = false;
			var adds = [];
			function getAddress() {
				if (gotAddress) {
					return;
				}
				;

				gotAddress = true;
				$.get("/buy/getaddress", null, function(v) {
					adds = v;
					updateAddressList();
				}, "json");
			}
			function updateAddressList() {
				var tpl = $("#address_tpl").html();
				$(".address_log dd").remove();
				for ( var i in adds) {
					var item = tpl;
					item = item.replace("{id}", adds[i].id);
					item = item.replace("{receiver_name}",
							adds[i].receiver_name);
					item = item.replace("{receiver_mobile}",
							adds[i].receiver_mobile);
					item = item.replace("{receiver_state}",
							adds[i].receiver_state);
					item = item.replace("{receiver_city}",
							adds[i].receiver_city);
					item = item.replace("{receiver_district}",
							adds[i].receiver_district);
					item = item.replace("{receiver_address}",
							adds[i].receiver_address);
					$(".address_log").append(item);
				}
			}

			function selectAddress(addr_id) {
				var address = {};
				for ( var i in adds) {
					if (adds[i].id == addr_id) {
						address = adds[i];
					}
				}

				address.express_type = "express";
				$.post("/my/updateaddress/?id=" + id, address, function(v) {
					if (v.f) {
						alert('修改成功！');
						$.get('/buy/updateaddressusedtime/', {
							id : addr_id
						}, null);
						window.location.reload();
					} else {
						FP.showError(v.data);
					}
				}, "json");
			}

			$(".address_log").delegate("dd", "click", function() {
				selectAddress($(this).attr("address-id"));
			});

			$("#confirmshunyan").bind("click", function() {
				if (!window.confirm('确认要顺延一周？')) {
					return;
				}
				var btn = $(this).prop("disabled", true);
				$.post("/my/confirmshunyan/?id=" + id, {
					last_date : last_date
				}, function(v) {
					window.location.reload();
				});
			});

			$("#renew_switch").change(function() {
				if ($(this).is(":checked")) {
					$.post('/my/open_sign_order', {
						oid : id
					}, function(v) {
						if (v.f) {
							alert('续约成功!');
							window.location.reload();
						} else {
							$("#renew_switch").prop('checked', false);
							FP.showError(v.data);
						}
					}, 'json');
				} else {
					$.post('/my/close_sign_order', {
						oid : id
					}, function(v) {
						if (v.f) {
							alert('解约成功!');
							window.location.reload();
						} else {
							$("#renew_switch").prop('checked', true);
							FP.showError(v.data);
						}
					}, 'json');
				}
			});

			$(" #hideorder").bind("click", function() {
				if (!window.confirm("删除的订单不在用户中心显示，但不影响正常配送，请放心使用！\n确认要删除？")) {
					return;
				}
				$.post("/my/hideorder", {
					id : id
				}, function() {
					window.location.replace("/my");
				});
			});
			$("body").delegate(
					"input[type='tel']",
					"input",
					function() {
						$(this).val(
								$(this).val().replace(/[^0-9]/g, '').replace(
										/^86/, ''))
					});

			$(".xq dl:last,.fy dl:last").css('border-bottom', '0');
			$(".close_pay").click(function(event) {
				event.stopPropagation();
				$(".flower_pay,.grayout").hide();
			});

			$('#serviceItem').on('click', function() {
				var out_name = getCookie('user_source');
				if (out_name === 'bocom') {
					//alert('请联系客服电话:4008885928');
					window.location.href = '/web_ticket/list';
					return false;
				} else {
					window.location.href = '/front_ticket/ticket_list';
				}
			});
		</script>
		<script>
			//物流点赞2
			$(document).on(
					'click',
					'.zan',
					function() {
						var ships_id = $(this).parent('div.express_comment')
								.parent('div.showexpress_staff').parent(
										'div.routes').attr('data-id');
						var custmer_mobile = $('#oldPone').html();
						var mobile_Repg = /^(13|15|17|18)+\d{9}$/;
						var content = $(this).attr('comment');
						var staff_name = $(this).parent('div.express_comment')
								.siblings('div.express_staff').attr(
										'staff_name');
						var staff_mobile = $(this)
								.parent('div.express_comment').siblings(
										'div.express_staff').attr(
										'staff_mobile');
						if (!ships_id) {
							alert('ID错误请联系管理员');
							return false;
						}
						if (!mobile_Repg.test(custmer_mobile)) {
							alert('手机号码错误');
							return false;
						}
						if (!mobile_Repg.test(staff_mobile)) {
							alert('快递员手机号码错误');
							return false;
						}
						if (!staff_name) {
							alert('派件员名字获取失败');
						}
						var _this = $(this);
						$.ajax({
							url : '/kd/ajax_zan_exresss_staff',
							type : 'POST',
							data : {
								ships_id : ships_id,
								staff_name : staff_name,
								staff_mobile : staff_mobile,
								custmer_mobile : custmer_mobile,
								content : content
							},
							success : function(res) {
								var items = JSON.parse(res);
								if (items.f) {
									if (_this.find('i').hasClass('img_good1')) {
										_this.find('i')
												.removeClass('img_good1')
												.addClass('img_good2');
									} else if (_this.find('i').hasClass(
											'img_low1')) {
										_this.find('i').removeClass('img_low1')
												.addClass('img_low2');
									}
								} else {
									alert(items.data);
								}
							}
						})
					})
		</script>
		<script>
			/**
			 * 交通银行支付中
			 * @param url
			 * @param obj_data
			 * @returns {boolean}
			 */
			function bocompay(url, obj_data) {
				try {
					if (!obj_data.id || (url.indexOf('pay') === -1)) {
						FP.showError('预支付启动错误');
						return false;
					}
					$.ajax({
						url : url,
						data : obj_data,
						type : 'POST',
						success : function(req) {
							var r = JSON.parse(req);
							console.log(r)
							if (r.f) {
								$('#bocom_pay_form').html(r.data);
							} else {
								FP.showError(r.data);
							}
						},
						error : function() {
							FP.showError('支付失败');
							return false;
						}
					})
				} catch (e) {
					FP.showError('支付失败');
					return false;
				}
			}
			function getCookie(name) {
				var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
				if (arr = document.cookie.match(reg))
					return unescape(arr[2]);
				else
					return null;
			}

			//判断是否是银联活动订单
			var is_up_activity_order = '';
			console.log(is_up_activity_order);
			if (is_up_activity_order) {
				$('.up_money').hide();
				$('.waitings_pay_price').hide();
			}
		</script>
		<!-- 详细地址地图的页面开始 -->
		<link rel="stylesheet" type="text/css"
			href="//static2.flowerplus.cn/Static/css/new_2017/daihou.css">
		<div class="map_out" style="display:none;background:#fff">
			<!--  头部的部分开始 -->
			<div class="map_container_header">
				<label>代收点地址详情</label> <a class="map_close" href="#"></a>
			</div>
			<!--  头部的部分结束 -->
			<div class="BMap_mask" id="BMap_mask"></div>
			<div class="Tit p3">
				<p class="img">
					<img src="" alt="logo" id="map_shop_logo">
				</p>
				<ul>
					<li><b id="map_shop_name"></b> <span id="map_shop_type"></span></li>
					<li id="map_shop_time"></li>
				</ul>
			</div>
			<p class="map_ads" id="map_shop_address"></p>
			<a href="" id="map_shop_phone" class="tel p3 l40"
				style="display:block;color:#333"></a>
			<div class="Discount p3">
				<div class="top" id="map_shop_tip"></div>
				<p id="map_shop_detail">在设置为提货点的时间区间，您将获得合作门店认证卡，凭卡享受该门店优惠。</p>
			</div>
		</div>
		<!-- 详细地址地图的页面结束 -->

		<!-- 提货人的页面结束 -->
		<div class="taker_list_container" style="display:none;background:#fff">
			<div class="taker_list_header" style="position:relative;">
				<label>提货人管理</label> <a class="taker_close" href="javascript:;"></a>
			</div>
			<div class="taker_list_inputs">
				<dl class="taker-info-item">
					<dt>提货人</dt>
					<dd>
						<input type="text" id="taker_name" placeholder="姓名">
					</dd>
				</dl>
				<dl class="taker-info-item">
					<dt>电话</dt>
					<dd>
						<input type="tel" id="taker_mobile" placeholder="提货人手机">
					</dd>
				</dl>
				<div class="taker-save-wrap">
					<button class="taker-save">保存</button>
				</div>
			</div>
			<div class="taker_list_log">
				<div class="taker_list_log_title">历史提货人</div>
				<div class="taker_list_log_item">
					<table>
						<col style="width:20%"></col>
						<col style="width:65%"></col>
						<col style="width:15%"></col>
						<tbody id="taker_list_items">
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!--  提货人的页面结束 -->

		<!-- 代收点的页面开始-->
		<div class="ds_wpage" style="display:none">
			<!-- 代收点显示一部分 -->
			<div class="wpage">
				<header
					style="font-size:16px;font-weight:bolder;color:#44450;line-height:45px">
					代收服务 <a class="deliver-close first-deliver-close" style=""></a>
				</header>
				<!--div  class="daishou_promotion">
			代收点有优惠活动哦！
	</div-->
				<div class="banner" style="max-height: 300px;overflow: hidden;">
					<img src="//static2.flowerplus.cn/Static/img/daishou.png"
						style="width:100%;" alt="" />
					<p>我们正与品牌门店合作提供免费代收服务。您可选择附近的代收点为收货地址，收花日收到短信后在营业时间内到店自提即可。</p>
				</div>
				<p class="ads">
					收货地址：<span id='ads_content'></span>
				</p>
				<p class="p3 l45 bb ti-tit">附近的代收点</p>
				<div class="daishou_recommend_list">
					<!--代收点列表-->
				</div>
				<a href="javascript:void(0);" class="select l45"
					style="display:inline-block;width:100%;color:#333;background:#fff!important">查看全部代收点</a>
			</div>
			<!-- 代收点显示一部分 -->
			<!-- 全部的代收开始-->
			<div class="wpage" style="display:none;background:#fff">
				<!-- 头部的标签开始 -->
				<header clss="ALLds">
					<div class="header"
						style="font-size:1.6rem;font-weight:bolder;line-height:45px;">
						代收服务<a class="deliver-close second-deliver-close"></a>
					</div>
					<!-- 选择省份的输入框开始 -->
					<div class="daishou_address_area">
						<div class="daishou_address_div">
							<select class="form-control" id="daishou_state"
								name="daishou_state"><option>选择省份</option>
								<span></span></select> <select class="form-control" id="daishou_city"
								name="daishou_city"><option>选择城市</option></select> <select
								class="form-control" id="daishou_district"
								name="daishou_district"><option>选择区县</option></select>
						</div>
						<div class="daishou_address_search_area">
							<button class="address_search_button"></button>
						</div>
					</div>
					<!-- 选择省份的输入框结束 -->
					<!-- 搜索的功能开始 -->
					<div class="daishou_address_search" style="display:none">
						<div class="daishou_address_search_text">
							<input type="text" id="seach_keyword" name="seach_keyword"
								placeholder="请输入路名或代收点" />
							<div class="daishou_address_search_button">
								<button onClick="searchWithKeyword()">搜索</button>
								<button onClick="cancelSearch()" style="background-color:#bbb">取消</button>
							</div>
						</div>
					</div>
					<!-- 搜索的功能结束 -->
				</header>
				<!-- 头部的标签结束 -->
				<div class="wrap-page full_daishou_list" style="diaplay:none">
				</div>
			</div>
			<!-- 全部的代收点结束 -->
			<!--  尾部的开始 -->
			<div class="trans1"></div>
			<footer>
				<div class="p3 clearfix name bb">
					<p class="l" style="line-height:45px">
						<b>提货人:</b> <span id="taker_name_default"></span>
					</p>
					<p class="r"
						style="margin-right:30px;color:#413f47;line-height:45px">
						<span id="taker_mobile_default"></span>
					</p>
				</div>
				<button id="selected_daishou_btn">配送至代收点</button>
			</footer>
			<!--  尾部的结束-->
		</div>
		<!-- 代收点的页面结束 -->

		<!-- 弹出框 -->
		<style>
.alert_clause {
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, 0.6);
	z-index: 2222;
	position: fixed;
	left: 0;
	right: 0;
	bottom: 0;
	top: 0
}

.alert_clause_main {
	width: 85%;
	background: #fff;
	position: fixed;
	border-radius: 4px;
	overflow: hidden;
}

.alert_clause_main_in {
	padding: 10px;
}

.alert_clause button {
	width: 100%;
	height: 30px;
	line-height: 30px;
	background: #f6658f;
	text-align: center;
	color: white;
	border: 0;
	border-radius: 5px;
	margin-top: 10px
}

.alert_clause_main_in .center {
	height: 100px;
	overflow-y: auto;
	-webkit-overflow-scrolling: touch;
}

.top span {
	position: absolute;
	right: 10px;
	top: 5px;
	background: url(image/iconfont-close-tiny.png);
	width: 25px;
	height: 25px;
	background-size: 25px 25px;
	-moz-background-size: 25px 25px;
	-webkit-background-size: 25px 25px;
}

.center tr td {
	vertical-align: top;
	line-height: 18px
}

.center tr td:first-child {
	font-weight: bold;
}
</style>
		<div class="alert_clause" style="display:none">
			<div class="alert_clause_main">
				<div class="alert_clause_main_in">
					<div class="top">
						<p style="text-align:center;line-height:35px;font-size:16px">代收点活动介绍</p>
						<span class="close"></span>
					</div>
					<table class="center">
						<tbody>
							<tr>
								<td>1.</td>
								<td>在不方便收件或者对快递的服务不满意时可选择花+提供的免费代收点服务；</td>
							</tr>
							<tr>
								<td>2.</td>
								<td>新客户下单时选择门店代收，已下单的老客户在订单详情中更改配送方式均可领取“花+代收门店会员认证卡”，您可以在“会员中心”查看；</td>
							</tr>
							<tr>
								<td>3.</td>
								<td>订单结束或者更改为其他配送方式，“花+代收门店会员认证卡”将被收回；</td>
							</tr>
							<tr>
								<td>4.</td>
								<td>代收站点仅提供代收服务。合作门店除代收服务外，也将会不定期提供会员特权福利；</td>
							</tr>
							<tr>
								<td>5.</td>
								<td>凭认证卡可享受对应代收门店的优惠特权，详细信息可参考门店的红色文字提示或查看认证卡优惠说明；<b>4月13日-5月13日
								</b>凡选择代收的客户，在门店每签收一次都将 <b style="color:red">获得2积分</b>（可累计获得多次积分，1积分可抵扣1元）；
								</td>
							</tr>
						</tbody>
					</table>
					<p style="text-align:center;font-weight:bold;color:#999">
						<br />花+对本活动保有最终解释权。<br />
					</p>
					<button>知道了</button>
				</div>
			</div>
		</div>

		<!-- 弹出框 -->

		<script type="text/html" id="daishou_list_item_tpl">
	 	<div class="daishou_list_item pa bb" itemid="{id}">
		<table style="width:100%">
			<colgroup>
				<col width="8%">
				<col width="78%">
				<col width="14%">
			</colgroup>
			<tbody>
				<tr style="height:20px">
					<td>
					<span class="daishou_list_item_radio"><b></b></span>
					</td>
					<td style="font-size:16px;font-weight:bold">{shop_name} <b class="smal-t" {type_style}>{daishou_type}</b></td>
					<td style="font-size:12px;color:#ccc"> </td>
				</tr>
			<tr>
				<td></td>
				<td style="font-size:14px;color:#888">{shop_address}<br></td>
				<td style="text-align:center"><img item="{id}" class="daishou_list_item_pointer" src="/Static/img/dw.png"></td>
			</tr>
			<tr>
				<td></td>
				<td style="font-size:14px;color:#888">营业时间 {shopping_time}  </td>
				<td style="text-align:center;font-size:12px;color:#666">{shop_distance}</td>
			</tr>
		</tbody>	
		 </table>
		 <p style="color:#fc780b;padding-left:8%;margin-top:3px;display:{comment_block}"><span style="padding:0px 4px;display:inline-block;color:#fff;background:#fc780b;border-radius:3px;margin-right:5px">惠</span>
		 	{comment} </p>
		</div>
</script>
		<script type="text/html" id="takerlist_tpl">
    <tr item={id} item_name={taker_name}>
        <td>{taker_name}</td>
        <td style="text-align:right;">{taker_mobile}</td>
        <td></td>
    </tr>
</script>

		<!-- <script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=cddPGX3yYjB5D7UvaGnzZMzq"></script> -->
		<script>
			var daishou_data = {
				receiver_name : '',
				receiver_mobile : '',
				receiver_state : '',
				daishou_shop_id : 0,
				daishou_shop_name : '',
				daishou_shop_address : '',
			};

			var recommended_daishou_list;
			var full_daishou_list;
			var map = null;
			var map_marker;
			var map_info_window;

			$.address_b("daishou_state", "daishou_city", "daishou_district");
			$("#daishou_state").change(daishouCityChanged);
			$("#daishou_city").change(daishouCityChanged);
			$("#daishou_district").change(daishouCityChanged);

			//展示统一调用函数
			function ds_show_daishou_picker(address_id) {
				$('.ds_wpage').show();
				//加载地址数据
				if (address_id > 0) {
					var post = {
						'address_id' : address_id
					};
					$
							.post(
									'/buy/get_recommend_ds_shops',
									post,
									function(v) {
										if (v.f) {
											var address = v.data.address;
											$('#ads_content')
													.html(
															address.receiver_state
																	+ address.receiver_district
																	+ ' '
																	+ address.receiver_address);
											$("#taker_name_default").html(
													address.receiver_name);
											$("#taker_mobile_default").html(
													address.receiver_mobile);

											daishou_data.receiver_name = address.receiver_name;
											daishou_data.receiver_mobile = address.receiver_mobile;

											$(".daishou_recommend_list").html(
													'');
											var tpl = $(
													"#daishou_list_item_tpl")
													.html();
											recommended_daishou_list = v.data.shops;
											var html = daishou_list_html(recommended_daishou_list);
											$(".daishou_recommend_list").html(
													html);
										} else {
											alert(v.data);
										}
									}, 'json');
				}
				;
			}

			//展示统一调用函数
			function ds_show_daishou_picker_with_oid(order_id) {
				$('.ds_wpage').show();
				//加载地址数据
				if (order_id > 0) {
					var post = {
						'order_id' : order_id
					};
					$
							.post(
									'/buy/get_recommend_ds_shops_for_oid',
									post,
									function(v) {
										if (v.f) {
											var address = v.data.address;
											$('#ads_content')
													.html(
															address.receiver_state
																	+ address.receiver_district
																	+ ' '
																	+ address.receiver_address);
											$("#taker_name_default").html(
													address.receiver_name);
											$("#taker_mobile_default").html(
													address.receiver_mobile);

											daishou_data.receiver_name = address.receiver_name;
											daishou_data.receiver_mobile = address.receiver_mobile;

											$(".daishou_recommend_list").html(
													'');
											var tpl = $(
													"#daishou_list_item_tpl")
													.html();
											recommended_daishou_list = v.data.shops;
											var html = daishou_list_html(recommended_daishou_list);
											$(".daishou_recommend_list").html(
													html);
										} else {
											alert(v.data);
										}
									}, 'json');
				}
				;
			}

			//关闭统一调用函数,需要自己定义
			//function ds_hide_daishou_picker(){};

			//选择完成的统一回调,需要自己定义
			//function ds_when_selected_daishou(daishou_data){};

			$(".daishou_recommend_list").delegate(
					".daishou_list_item",
					"click",
					function(event) {
						event.stopPropagation();
						var check = $(this).find('.daishou_list_item_radio b')
						if (check.css("display") == 'none') {
							check.css('display', 'block');
							$(this).siblings('.daishou_list_item').find(
									'.daishou_list_item_radio b').css(
									'display', 'none');
							$(".full_daishou_list").find(
									'.daishou_list_item_radio b').css(
									'display', 'none');
						}

						var itemId = $(this).attr("itemid");
						var items = $.grep(recommended_daishou_list,
								function(n) {
									return n.id == itemId;
								});

						var item = items[0];
						daishou_data.daishou_shop_id = itemId;
						daishou_data.daishou_shop_name = item.shop_name;
						daishou_data.daishou_shop_address = item.city
								+ item.district + item.address;
						daishou_data.receiver_state = item.state;
					});

			$(".full_daishou_list").delegate(
					".daishou_list_item",
					"click",
					function(event) {
						event.stopPropagation();
						var check = $(this).find('.daishou_list_item_radio b')
						if (check.css("display") == 'none') {
							check.css('display', 'block');
							$(this).siblings('.daishou_list_item').find(
									'.daishou_list_item_radio b').css(
									'display', 'none');
							$(".daishou_recommend_list").find(
									'.daishou_list_item_radio b').css(
									'display', 'none');

							var itemId = $(this).attr("itemid");
							var items = $.grep(full_daishou_list, function(n) {
								return n.id == itemId;
							});

							var item = items[0];
							daishou_data.daishou_shop_id = itemId;
							daishou_data.daishou_shop_name = item.shop_name;
							daishou_data.daishou_shop_address = item.city
									+ item.district + item.address;
							daishou_data.receiver_state = item.state;
						} else {
							check.css('display', 'none');
							daishou_data.daishou_shop_id = 0;
							daishou_data.daishou_shop_name = "";
							daishou_data.daishou_shop_address = "";
							daishou_data.receiver_state = "";
						}
					});

			// 定位的小点的事件
			$(".daishou_recommend_list").delegate(
					".daishou_list_item .daishou_list_item_pointer",
					"click",
					function(e) {
						e.stopPropagation();
						$(this).parents('.ds_wpage').hide()
								.siblings('.map_out').show();

						var itemId = $(this).attr("item");
						var items = $.grep(recommended_daishou_list,
								function(n) {
									return n.id == itemId;
								});

						var item = items[0];
						bind_mapview_data(item);
					});

			$(".full_daishou_list").delegate(
					".daishou_list_item .daishou_list_item_pointer",
					"click",
					function(e) {
						e.stopPropagation();
						$(this).parents('.ds_wpage').hide()
								.siblings('.map_out').show();

						var itemId = $(this).attr("item");
						var items = $.grep(full_daishou_list, function(n) {
							return n.id == itemId;
						});

						var item = items[0];
						bind_mapview_data(item);
					});

			$(".ds_wpage .first-deliver-close").click(function(event) {
				$('.ds_wpage').hide();

				//调用隐藏回调
				ds_hide_daishou_picker();
			});
			$(".ds_wpage .second-deliver-close").click(function(event) {
				$(this).parents(".wpage").hide().siblings('.wpage').show();
			});

			$(".ds_wpage .select").click(function(event) {
				$(this).parents(".wpage").hide().siblings('.wpage').show();
				searchAllSattion('上海');
			});

			function daishou_list_html(daishou_list) {
				if (daishou_list == null || daishou_list.length == 0) {
					var html = "<table style=\"width:100%;border-bottom:1px solid #ddd\"><tr><td style=\"text-align:center;height:60px;color:#666\">没有找到代收点<td></tr></table>"
					return html;
				}
				;

				var tpl = $("#daishou_list_item_tpl").html();
				var html = '';
				for (var i = 0; i < daishou_list.length; i++) {
					var shop = daishou_list[i];
					var item = tpl;
					item = item.replace(/\{id\}/ig, shop.id);
					item = item.replace("{shop_name}", shop.shop_name);
					item = item.replace("{shop_address}", shop.city
							+ shop.district + shop.address);

					item = item
							.replace("{shop_phone}", shop.shop_manager_phone);

					var comment = shop.comment;
					if (comment != null && $.trim(comment) != "") {
						item = item.replace("{comment_block}", "block");
						item = item.replace("{comment}", comment);
					} else {
						item = item.replace("{comment_block}", "none");
						item = item.replace("{comment}", "");
					}

					var daishou_type = shop.daishou_type;
					if (parseInt(daishou_type) == 1) {
						item = item.replace("{daishou_type}", "合作门店");
						item = item.replace("{type_style}",
								"style='background: #fb95ad;'");
					} else if (parseInt(daishou_type) == 2) {
						item = item.replace("{daishou_type}", "代收站点");
						item = item.replace("{type_style}",
								"style='background: #aaa;'");
					} else {
						item = item.replace("{daishou_type}", "");
					}

					if (shop.distance != null) {
						item = item.replace("{shop_distance}", shop.distance
								+ "米");
					} else {
						item = item.replace("{shop_distance}", " ");
					}

					var shopping_time = shop.start_time.substring(0, 5) + " ~ "
							+ shop.end_time.substring(0, 5)
					item = item.replace("{shopping_time}", shopping_time);
					html += item;
				}

				return html;
			}

			function bind_mapview_data(item) {
				if (item.logo != null) {
					$("#map_shop_logo").attr("src", item.logo);
					$(".map_info_logo").css("display", "block");
				} else {
					$("#map_shop_logo").attr("src", '');
					$(".map_info_logo").css("display", "none");
				}

				$("#map_shop_name").html(item.shop_name);

				var daishou_type = item.daishou_type;
				daishou_type = parseInt(daishou_type);
				if (daishou_type == 1) {
					$("#map_shop_type").html("合作门店");
					$("#map_shop_type").css("background", "#fb95ad");
				} else if (daishou_type == 2) {
					$("#map_shop_type").html("代收站点");
					$("#map_shop_type").css("background", "#aaa");
				}

				var shopping_time = item.start_time.substring(0, 5) + " ~ "
						+ item.end_time.substring(0, 5);
				$("#map_shop_time").html("营业时间：" + shopping_time);

				var fullAddress = item.city + item.district + item.address;
				$("#map_shop_address").html("地址：" + fullAddress);
				$("#map_shop_phone").html(item.shop_manager_phone);
				$("#map_shop_phone").attr("href",
						"tel://" + item.shop_manager_phone);

				if (item.comment != null && $.trim(item.comment).length > 0) {
					$("#map_shop_tip").html("<label>惠</label> " + item.comment);
					$("#map_shop_detail").css("display", "inline-block");
				} else {
					$("#map_shop_tip").html("");
					$("#map_shop_detail").css("display", "none");
				}

				if ($.isEmptyObject(map)) {
					map = new BMap.Map("BMap_mask");
					map.addControl(new BMap.GeolocationControl());
					var opts = {
						type : BMAP_NAVIGATION_CONTROL_ZOOM
					};
					map.addControl(new BMap.NavigationControl(opts));
					map.disableDragging();
				}

				map_marker = null;
				map.removeOverlay(map_marker);

				var opts = {
					width : 0,
					height : 0,
					offset : new BMap.Size(0, -25),
					title : "<h3>" + item.shop_name + "</h3>",
					maxWidth : 220
				}

				var center = new BMap.Point(item.lng, item.lat);
				map_marker = new BMap.Marker(center);
				map.addOverlay(map_marker);
				map.centerAndZoom(center, 18);

				map_info_window = new BMap.InfoWindow(fullAddress, opts);
				setTimeout(function() {
					map.openInfoWindow(map_info_window, center);
				}, 500);
			}

			function daishouCityChanged() {
				var address = {
					state : $("#daishou_state").val(),
					city : $("#daishou_city").val(),
					district : $("#daishou_district").val()
				};

				$.post('/buy/search_stations', address, function(v) {
					full_daishou_list = v;
					var html = daishou_list_html(full_daishou_list);
					$(".full_daishou_list").html(html);
				}, "json");
			}

			$(".address_search_button").click(function(event) {
				$(".daishou_address_search").css('display', 'block');
				$(".daishou_address_search_text input").focus();
			});

			function cancelSearch() {
				$(".daishou_address_search").css("display", "none");
				$(".daishou_address_search_text input").focus();
			}

			function searchWithKeyword() {
				var keyword = $("#seach_keyword").val();
				keyword = $.trim(keyword);
				if (keyword.length >= 2) {
					$(".daishou_address_search").css("display", "none");

					var info = {
						k : keyword
					};

					$.post('/buy/search_stations', info, function(v) {
						full_daishou_list = v;
						var html = daishou_list_html(full_daishou_list);
						$(".full_daishou_list").html(html);
					}, "json");
				} else {
					alert("至少输入两个关键字");
				}
			}

			function searchAllSattion(city) {
				var info = {
					k : "all",
				};

				if (city != null) {
					info.city = city;
				}
				;

				$.post('/buy/search_stations', info, function(v) {
					full_daishou_list = v;
					var html = daishou_list_html(full_daishou_list);
					$(".full_daishou_list").html(html);
				}, "json");
			}

			$(".map_out .map_close").click(
					function(event) {
						$(this).parents(".map_out").hide()
								.siblings('.ds_wpage').show();
					});

			$("#selected_daishou_btn").click(function(e) {
				if (daishou_data.daishou_shop_id == 0) {
					FP.showError("请选择一个门店！");
					return;
				}
				;

				if (daishou_data.receiver_name == '') {
					FP.showError("请填写提货人！");
					return;
				}
				;

				if (daishou_data.receiver_mobile == '') {
					FP.showError("请填写提货人手机号！");
					return;
				}
				;

				ds_when_selected_daishou(daishou_data);
				$(".taker_list_container").hide();
				$(".ds_wpage").hide();
				$(".map_out").hide();

				//调用隐藏回调
				ds_hide_daishou_picker();
			});
		</script>

		<script>
			var all_takers = [];
			$("footer .name").click(
					function(event) {
						$(this).parents(".ds_wpage").hide().siblings(
								'.taker_list_container').show();
						if (all_takers.length == 0) {
							updateAllTakersList();
						}
						;
					});

			$(".taker_list_container .taker_close").click(function(event) {
				$(".taker_list_container").hide().siblings(".ds_wpage").show();
			});

			$(".taker-save").bind(
					"click",
					function(e) {
						e.stopPropagation();
						var info = {
							taker_name : $("#taker_name").val().replace(
									'/^\s|\s$/g', ''),
							taker_mobile : $("#taker_mobile").val().replace(
									'/^\s|\s$/g', ''),
						};

						if (info.taker_name == "") {
							FP.showError("请填写提货人姓名！");
							return;
						}
						if (info.taker_mobile == "") {
							FP.showError("请填写提货人手机！");
							return;
						}

						var btn = $(this).prop("disabled", true);
						$.post('/buy/add_daishou_takers', info, function(v) {
							if (v.f) {
								$("#taker_name").val("");
								$("#taker_mobile").val("");
								adds = v.list;
								updateAllTakersList();
							} else {
								FP.showError(v.data);
							}
							btn.prop("disabled", false);
						}, "json");
					});

			function updateAllTakersList() {
				$
						.get(
								'/buy/get_daishou_takers',
								function(v) {
									if (v) {
										all_takers = v;
										var tpl = $("#takerlist_tpl").html();
										$("#taker_list_items").html('');
										for ( var i in all_takers) {
											var item = tpl;
											item = item.replace(/\{id\}/ig,
													all_takers[i].id);
											item = item.replace(
													/\{taker_name\}/ig,
													all_takers[i].taker_name);
											item = item.replace(
													"{taker_mobile}",
													all_takers[i].taker_mobile);
											$("#taker_list_items").append(item);
										}

										//找到需要选中的dom然后选中
										if (daishou_data
												.hasOwnProperty("daishou_taker_name")) {
											$("#taker_list_items tr")
													.each(
															function() {
																if ($(this)
																		.attr(
																				"item_name") == data.daishou_taker_name) {
																	$(this)
																			.find(
																					"td:eq(2)")
																			.addClass(
																					"add-sel");
																}
																;
															});
										}
									}
								}, "json");
			}

			$("#taker_list_items").delegate("tr", "click", function() {
				$("#taker_list_items tr td").removeClass("add-sel");
				$(this).find("td:eq(2)").addClass("add-sel");

				//记录代收取货人id
				var itemId = $(this).attr('item');

				//更新界面
				var items = $.grep(all_takers, function(n) {
					return n.id == itemId;
				});

				var item = items[0];
				$("#taker_name_default").html(item.taker_name);
				$("#taker_mobile_default").html(item.taker_mobile);

				daishou_data.receiver_name = item.taker_name;
				daishou_data.receiver_mobile = item.taker_mobile;

				$(".taker_list_container").hide().siblings(".ds_wpage").show();
			});
		</script>

	</div>

</body>
</html>
